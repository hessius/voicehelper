<!-- DOCUMENTATION AVAILABLE @ voicehelper.com/docs.html-->
<html>
  <head>
    <title>Loading</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Varela+Round&display=swap');

      * {
        margin: 0;
        padding: 0;
        font-family: 'Varela Round', sans-serif;
      }

      .hero {
        width: 100%;
        height: 100vh;
        background: #f5f7fd;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.5s ease-in-out;
        opacity: 0;
      }
      .hide {
        display: none;
      }
      .show {
        opacity: 1;
      }
      #searchBox {
        position: relative;
        border-radius: 55px;
        padding: 30px;
        background: #f5f7fd;
        display: flex;
        align-items: center;
        box-shadow: 6px 6px 10px -1px rgba(0, 0, 0, 0.15),
          -6px -6px 10px -1px rgba(255, 255, 255, 0.7);
        animation-duration: 0.5s;
        animation-fill-mode: both;
      }

      input {
        font-size: 20px;
        width: 0px;
        border: 0;
        background: transparent;
        outline: none;
        transition: 2s;
        width: 500px;
        padding: 12px 20px;
      }

      .gg-search {
        box-sizing: border-box;
        position: relative;
        display: block;
        transform: scale(var(--ggs, 2));
        width: 16px;
        height: 16px;
        border: 2px solid;
        border-radius: 100%;
        margin-left: -4px;
        margin-top: -4px;
        left: 36px;
        top: 46px;
      }

      .gg-search::after {
        content: '';
        display: block;
        box-sizing: border-box;
        position: absolute;
        border-radius: 3px;
        width: 2px;
        height: 8px;
        background: currentColor;
        transform: rotate(-45deg);
        top: 10px;
        left: 12px;
      }
      #submit {
        height: 108px;
        width: 100px;
        float: right;
        position: absolute;
        right: 0;
      }
      @keyframes bounceIn {
        from,
        20%,
        40%,
        60%,
        80%,
        to {
          animation-timing-function: cubic-bezier(0.215, 0.61, 0.355, 1);
        }

        0% {
          opacity: 0;
          transform: scale3d(0.3, 0.3, 0.3);
        }

        20% {
          transform: scale3d(1.1, 1.1, 1.1);
        }

        40% {
          transform: scale3d(0.9, 0.9, 0.9);
        }

        60% {
          opacity: 1;
          transform: scale3d(1.03, 1.03, 1.03);
        }

        80% {
          transform: scale3d(0.97, 0.97, 0.97);
        }

        to {
          opacity: 1;
          transform: scale3d(1, 1, 1);
        }
      }

      .bounceIn {
        animation-duration: calc(var(--animate-duration) * 0.75);
        animation-name: bounceIn;
        animation-delay: 0.3s;
      }
      @keyframes fade {
        0% {
          opacity: 0;
          transform: translate(-50%, -50%) scale(0.8);
        }
        50% {
          opacity: 0;
          transform: translate(-50%, -50%) scale(0.8);
        }
        100% {
          opacity: 1;
          transform: translate(-50%, -50%) scale(1);
        }
      }
      .confirm *,
      .confirm *:after,
      .confirm *:before,
      .confirm *::after,
      .confirm *::before,
      .confirm::after,
      .confirm::before,
      .confirm {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      .confirm {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 80%;
        min-width: 280px;
        max-width: 500px;
        height: auto;
        background: #e2e2e2;
        border-radius: 10px;
        padding: 0;
        margin: 0;
        border-top: 1px solid white;
        animation: fade 1s ease-in-out 1 forwards;
        font-family: 'HelveticaNeue-Light', 'Helvetica Neue Light',
          'Helvetica Neue', 'Helvetica', 'Arial', 'Lucida Grande', sans-serif;
      }
      .confirm h1 {
        text-align: center;
        font-size: 1.2rem;
        margin: 1.5rem 1rem 0.5rem;
      }
      .confirm p {
        text-align: center;
        font-size: 1rem;
        margin: 0 2rem 4.5rem;
      }
      .confirm button {
        background: transparent;
        border: none;
        color: #1678e5;
        height: 3rem;
        font-size: 1rem;
        width: 100%;
        position: absolute;
        bottom: 0;
        cursor: pointer;
      }
      .confirm button:nth-of-type(1) {
        border-top: 1px solid #b4b4b4;
        border-right: 1px solid #b4b4b4;
        left: 0;
        border-radius: 0 0 0 10px;
      }
      .confirm button:nth-of-type(2) {
        border-top: 1px solid #b4b4b4;
        right: 0;
        border-radius: 0 0 10px 0;
      }
      .confirm button:focus,
      .confirm button:hover {
        font-weight: bold;
        background: #efefef;
      }
      .confirm button:active {
        background: #d6d6d6;
      }
    </style>
  </head>
  <body>
    <div class="hero hide">
      <form method="post" id="searchform" name="searchform">
        <div id="searchBox" class="active bounceIn">
          <input type="text" placeholder="Search" id="searchInput" />
          <div id="submit">
            <i class="gg-search"></i>
          </div>
        </div>
      </form>
    </div>
    <script>
      if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
        location.replace(
          `https:${location.href.substring(location.protocol.length)}`
        )
      }
      let domainList = {
        // Note: Domains should be listed in alphabetical order.
        bing: {
          url: 'https://www.bing.com/search?q=',
          name: 'Bing'
        },
        b: {
          url: 'https://www.bing.com/search?q=',
          name: 'Bing'
        },
        bdpm: {
          url:
            'https://www.google.com/search?q=site%3Ahttps%3A%2F%2Fbase-donnees-publique.medicaments.gouv.fr%2F+',
          name: 'BASE DE DONNÉES PUBLIQUE DES MÉDICAMENTS',
          lang: 'fr'
        },
        fass: {
          url: 'https://www.fass.se/LIF/result?&userType=0&query=',
          name: 'FASS',
          lang: 'sv'
        },
        g: {
          url: 'https://www.google.com/search?q=',
          name: 'Google'
        },
        gi: {
          url:
            'https://giftinformation.se/lakare/searchpage/?category=all&query=',
          name: 'Giftinfo',
          lang: 'sv',
          filter: /^[a-zA-Z0-9äöåÄÖÅ]+[\s]{1}[a-zA-Z0-9äöåÄÖÅ]+/
        },
        giftinfo: {
          url:
            'https://giftinformation.se/lakare/searchpage/?category=all&query=',
          name: 'Giftinfo',
          lang: 'sv',
          filter: /^[a-zA-Z0-9äöåÄÖÅ]+[\s]{1}[a-zA-Z0-9äöåÄÖÅ]+/
        },
        google: {
          url: 'https://www.google.com/search?q=',
          name: 'Google'
        },
        has: {
          url:
            'https://www.has-sante.fr/jcms/fc_2875171/fr/resultat-de-recherche?text=',
          name: 'HAS',
          lang: 'fr'
        },
        icd: {
          url: 'http://icd.internetmedicin.se/',
          name: 'ICD.nu',
          lang: 'sv'
        },
        im: {
          url: 'https://www.internetmedicin.se/?s=',
          name: 'Internetmedicin',
          lang: 'sv'
        },
        internetmedicin: {
          url: 'https://www.internetmedicin.se/?s=',
          name: 'Internetmedicin',
          lang: 'sv'
        },
        ji: {
          url: 'https://janusinfo.se/ovrigt/sokresultat.html?query=',
          name: 'JanusInfo',
          lang: 'sv'
        },
        janusinfo: {
          url: 'https://janusinfo.se/ovrigt/sokresultat.html?query=',
          name: 'JanusInfo',
          lang: 'sv'
        },
        lakemedelsboken: {
          url:
            'https://lakemedelsboken.se/?iso=true&imo=false&nplId=null&search=',
          name: 'Läkemedelsboken',
          lang: 'sv'
        },
        lmb: {
          url:
            'https://lakemedelsboken.se/?iso=true&imo=false&nplId=null&search=',
          name: 'Läkemedelsboken',
          lang: 'sv'
        },
        mdc: {
          url: 'https://www.mdcalc.com/search?s=',
          name: 'MD Calc',
          lang: 'en'
        },
        mdcalc: {
          url: 'https://www.mdcalc.com/search?s=',
          name: 'MD Calc',
          lang: 'en'
        },
        medscape: {
          url: 'https://search.medscape.com/search/?plr=ref&q=',
          name: 'Medscape',
          lang: 'en'
        },
        mesh: {
          url: 'https://mesh.kib.ki.se/Mesh/search/?searchterm=',
          name: 'Mesh',
          lang: 'sv'
        },
        ms: {
          url: 'https://search.medscape.com/search/?plr=ref&q=',
          name: 'Medscape',
          lang: 'en'
        },
        pm: {
          url: 'https://www.praktiskmedicin.se/?s=',
          name: 'Praktisk Medicin',
          lang: 'sv'
        },
        praktiskmedicin: {
          url: 'https://www.praktiskmedicin.se/?s=',
          name: 'Praktisk Medicin',
          lang: 'sv'
        },
        u2d: {
          url: 'https://www.uptodate.com/contents/search?search=',
          name: 'Uptodate',
          lang: 'en'
        },
        uptodate: {
          url: 'https://www.uptodate.com/contents/search?search=',
          name: 'Uptodate',
          lang: 'en'
        },
        utd: {
          url: 'https://www.uptodate.com/contents/search?search=',
          name: 'Uptodate',
          lang: 'en'
        },
        vhb: {
          url: 'https://www.vardhandboken.se/sok/?q=',
          name: 'Vårdhandboken',
          lang: 'sv'
        },
        vardhandboken: {
          url: 'https://www.vardhandboken.se/sok/?q=',
          name: 'Vårdhandboken',
          lang: 'sv'
        }
      }
      let url, translate, slang, tlang, name, site, filter, blocked
      let resultsArray = []
      //function that receives a url and creates a link to it in the document, clicks the link and removes the link from the document
      function openPopUp (urlToOpen) {
        var popup_window = window.open(urlToOpen, '_blank')
        try {
          popup_window.focus()
        } catch (e) {
          // dialog confirm box if the popup is blocked by the browser and pressing ok opens the popup in a new tab
          blocked = true
        }
      }
      document.addEventListener('DOMContentLoaded', function () {
        let urlParams = new URLSearchParams(window.location.search)
        site = urlParams.get('site')
        slang = urlParams.get('lang')
        document.addEventListener('paste', handlePaste)
        if (site) {
          if (domainList[site]) {
            url = domainList[site].url
            name = domainList[site].name
            filter = domainList[site].filter
            //set placeholder for textinput in searchbox to "search" + name
            document.getElementById('searchBox').children[0].placeholder =
              'Search ' + name
            if (
              domainList[site].lang &&
              slang &&
              domainList[site].lang !== slang
            ) {
              translate = true
              slang = lang
              tlang = domainList[site].lang
            } else {
              translate = false
            }
          } else if (site.startsWith('http')) {
            url = site
          }
        } else {
          console.error('site param is empty')
        }
        //setTimeout(showUI, 10000) DISABLED FOR NOW - UNWANTED?
        document.title = 'Voice Helper Ready'
        document
          .getElementById('searchform')
          .addEventListener('submit', function (e) {
            e.preventDefault()
            submit()
          })

        document
          .getElementById('confirmConfirm')
          .addEventListener('click', function (e) {
            e.preventDefault()
            resultsArray.forEach(function (resulturl, index) {
              console.log(index)
              if (index === resultsArray.length - 1) {
                setTimeout(function () {
                  window.location.href = resulturl
                }, (index + 1) * 100)
              } else {
                setTimeout(function () {
                  window.open(resulturl, '_blank')
                }, (index + 1) * 100)
              }
            })
          })
      })
      document.getElementById('submit').addEventListener('click', function (e) {
        e.preventDefault()
        submit()
      })
      function submit () {
        let search = document.getElementById('searchform').elements[0]
        if (search.value) {
          console.log('Searching for: ' + search.value)
          if (url) {
            url = url + search.value
            window.location.href = url
          } else {
            alert('No site selected')
          }
        }
      }
      function translateQuery (text, sourcelang, translationlang) {
        let translationurl = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=${sourcelang}&tl=${translationlang}&dt=t&q=${text}`
        fetch(translationurl)
          .then(response => response.json())
          .then(data => {
            let translatedText = data[0][0][0]
            url = url + translatedText
            window.location.href = url
          })
      }
      function showUI () {
        if (url) {
          document.querySelector('.hero').classList.remove('hide')
          setTimeout(function () {
            document.querySelector('.hero').classList.add('show')
            //set focus to searchbox
            setTimeout(function () {
              document.getElementById('searchInput').focus()
            }, 300)
          }, 100)
        }
      }
      function clickConfirm () {
        document.getElementById('confirmConfirm').click()
      }
      function handlePaste (e) {
        var clipboardData, pastedData
        e.stopPropagation()
        e.preventDefault()
        //set timeout 100 ms and then click confirmconmfirm button

        clipboardData = e.clipboardData || window.clipboardData
        //split text on newlines
        pastedDataArray = clipboardData.getData('Text').split('\n')

        //remove empty lines
        pastedDataArray = pastedDataArray.filter(function (el) {
          return el.length > 0
        })
        //reverse array to get last line first
        pastedDataArray.reverse()
        //loop over each item in pastedDataArray
        pastedDataArray.forEach(function (item) {
          if (item) {
            //if item is the last item in array

            pastedData = item.toLowerCase().trim()

            if (filter) {
              let regex = new RegExp(filter)
              let match = regex.exec(pastedData)
              if (match) {
                pastedData = match[0]
              }
            }

            if (pastedData && url) {
              document.title = `Redirecting to ${name}`

              if (translate) {
                translateQuery(pastedData, slang, tlang)
              } else {
                gotourl = url + pastedData
                console.log(blocked)
                if (item === pastedDataArray[pastedDataArray.length - 1]) {
                  if (typeof blocked != undefined && blocked) {
                    // show confirm div
                    resultsArray.push(gotourl)
                    document.querySelector('.confirm').classList.remove('hide')
                  } else {
                    window.location.href = gotourl
                  }
                } else {
                  //add gotourl to resultsArray
                  resultsArray.push(gotourl)
                  //open url in new tab
                  openPopUp(gotourl)
                  //window.open(gotourl, '_blank')
                }
              }
            } else {
              showUI()
            }
          }
        })
      }
      document.addEventListener('keydown', function (e) {
        if (e.key === 'v') {
          setTimeout(clickConfirm, 100)
        }
      })
    </script>
    <div class="confirm hide">
      <h1>Open results</h1>
      <p>
        Multiple searches detected. Do you want to open the search results in a
        multiple tabs? (Whitelist popups on voicehelper.io to enable automatic
        opening of multiple results)
      </p>
      <button id="confirmConfirm" autofocus>Open</button>
    </div>
  </body>
</html>
